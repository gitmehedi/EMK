<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="member_member_form_view" model="ir.ui.view">
        <field name="name">res.partner.form.inherit</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="membership.view_partner_form"/>
        <field name="arch" type="xml">
            <xpath expr="//form/header" position="inside">
                <button string="Set Membership" name="%(action_set_membership)d" type="action"
                        attrs="{'invisible':[('member_sequence','!=',False)]}"
                        groups="member_user.group_mem_user_officer,membership_extension.group_membership_manager"/>
            </xpath>
            <xpath expr="//form" position="attributes">
                <attribute name="create">false</attribute>
            </xpath>
            <xpath expr="//button[@name='open_parent']" position="attributes">
                <attribute name="attrs">{'invisible':True}</attribute>
            </xpath>
            <xpath expr="//page[@name='sales_purchases']" position="attributes">
                <attribute name="attrs">{'invisible':True}</attribute>
            </xpath>
            <xpath expr="//field[@name='email']" position="attributes">
                <attribute name="attrs">{'readonly':True}</attribute>
            </xpath>
            <xpath expr="//form/header" position="after">
                <field name="state" invisible="True"/>
                <field name="company_id"/>
                <div attrs="{'invisible': [('state','!=','member'),('free_member','=',False)]}">
                    <div class="alert alert-info" role="alert" style="margin-bottom:0px; text-align:center;"
                         attrs="{'invisible': ['|',('membership_days_remaining','&gt;',30),('membership_days_remaining','=',0)]}">
                        Current membership will expire soon, see
                        <strong style="color: red;">Membership</strong>
                        tab.
                        <br/>
                        Please request for renew membership or active auto-renew feature.
                    </div>
                    <div class="alert alert-danger" role="alert" style="margin-bottom:0px; text-align:center;"
                         attrs="{'invisible': [('membership_days_remaining','&gt;',0)]}">
                        <strong style="color: red;">Membership Expired</strong>
                    </div>
                </div>
            </xpath>
            <xpath expr="//form/sheet/div/button[@name='toggle_active']" position="before">
                <button name="toggle_auto_renew" type="object" class="oe_stat_button" icon="fa-check-square"
                        groups="member_user.group_user_member,member_user.group_mem_user_officer">
                    <field name="auto_renew" widget="boolean_button"
                           options='{"terminology": {
                                            "string_true": "Active Renew",
                                            "hover_true": "Inactive Renew",
                                            "string_false": "Inactive Renew",
                                            "hover_false": "Active Renew"}}'/>
                </button>
            </xpath>
            <xpath expr="//form/sheet/div/button[@name='toggle_active']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <xpath expr="//field[@name='firstname']" position="attributes">
                <attribute name="required">True</attribute>
            </xpath>

            <xpath expr="//field[@name='name']" position="before">
                <field name="member_sequence" readonly="True" style="color: green;"
                       attrs="{'invisible':[('member_sequence','=',False)]}"/>
                <br/>
            </xpath>
            <xpath expr="//field[@name='lastname']" position="attributes">
                <attribute name="required">True</attribute>
            </xpath>
            <xpath expr="//field[@name='function']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <xpath expr="//field[@name='company_type']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <xpath expr="//field[@name='parent_id']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <xpath expr="//field[@name='fax']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <xpath expr="//field[@name='title']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <xpath expr="//field[@name='lang']" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <xpath expr="//group/group[field[@name='free_member']]" position="attributes">
                <attribute name="invisible">True</attribute>
            </xpath>
            <xpath expr="//group/group[field[@name='free_member']]" position="before">
                <group>
                    <field name="membership_status"/>
                </group>
            </xpath>

            <xpath expr="//notebook/page[@autofocus='autofocus']" position="before">
                <page name="member_personal_information" string="Personal Information" autofocus="autofocus">
                    <group>
                        <group string="Basic Information">
                            <field name="gender" widget="radio" options="{'horizontal': true}"/>
                            <field name="occupation"
                                   options="{'no_create_edit':True,'no_open':True}"/>
                            <field name="occupation_other"/>
                            <field name="subject_of_interest" widget="many2many_tags"
                                   options="{'no_create_edit':True,'no_open':True}"/>
                            <field name="subject_of_interest_others"/>
                        </group>
                        <group string="Educational Information">
                            <field name="last_place_of_study"/>
                            <field name="highest_certification"
                                   options="{'no_create_edit':True,'no_open':True}"/>
                            <field name="highest_certification_other"
                                   options="{'no_create_edit':True,'no_open':True}"/>
                            <field name="field_of_study"/>
                            <field name="place_of_study"/>
                            <field name="usa_work_or_study" widget="radio" options="{'horizontal': true}"/>
                            <field name="usa_work_or_study_place"
                                   attrs="{'invisible':[('usa_work_or_study','=','no')],'required':[('usa_work_or_study','=','yes')]}"/>
                            <field name="alumni_institute"/>
                        </group>
                    </group>
                    <group>
                        <group string="Additional Information">
                            <field name="current_employee"/>
                            <field name="work_title"/>
                            <field name="work_phone"/>
                            <field name="info_about_emk"/>
                        </group>
                        <group string="Signature">
                            <field name="signature_image" widget='image' class="oe_avatar"
                                   options='{"preview_signature_image": "image_medium", "size": [90, 90]}'/>
                        </group>
                    </group>
                </page>
            </xpath>
            <xpath expr="//form/sheet" position="after">
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </xpath>
        </field>
    </record>
    <record id="inherited_res_partner_kanban_view" model="ir.ui.view">
        <field name="name">res.partner.kanban</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="base.res_partner_kanban_view"/>
        <field name="arch" type="xml">
            <xpath expr="//kanban" position="attributes">
                <attribute name="create">false</attribute>
            </xpath>
        </field>
    </record>
    <record id="inherit_membership_members_tree" model="ir.ui.view">
        <field name="name">Member</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="membership.membership_members_tree"/>
        <field name="arch" type="xml">
            <xpath expr="//tree" position="replace">
                <tree string="Members" create="0" decoration-danger="membership_status =='inactive'"
                      decoration-success="membership_status =='active'"
                      decoration-info="membership_status =='restricted'">
                    <field name="member_sequence" string="Membership ID"/>
                    <field name="name"/>
                    <field name="phone"/>
                    <field name="email"/>
                    <field name="birth_date"/>
                    <field name="occupation"/>
                    <field name="highest_certification"/>
                    <field name="gender"/>
                    <field name="membership_last_start" string="Membership Start Date"/>
                    <field name="membership_stop"/>
                    <field name="membership_days_remaining"/>
                    <field name="membership_status"/>
                    <field name="user_id" invisible="1"/>
                </tree>
            </xpath>
        </field>
    </record>
    <record id="inherit_view_res_partner_member_filter" model="ir.ui.view">
        <field name="name">Member</field>
        <field name="model">res.partner</field>
        <field name="inherit_id" ref="membership.view_res_partner_member_filter"/>
        <field name="arch" type="xml">
            <xpath expr="//search" position="replace">
                <search string="Membership Partners">
                    <field name="name"
                           filter_domain="['|','|',('name','ilike',self),('parent_id','ilike',self),('ref','=',self)]"/>
                    <field name="member_sequence"/>
                    <field name="email"/>
                    <field name="mobile"/>
                    <field name="phone"/>
                    <field name="membership_start" invisible="1"/>
                    <field name="membership_stop" string="End Membership Date"/>
                    <filter name="all_non_members"
                            domain="[('membership_state', 'in', ['none','canceled','old','waiting'])]"
                            string="All non Members" help="None/Canceled/Old/Waiting"/>
                    <filter name="all_members" domain="[('membership_state', 'in', ['invoiced','paid','free'])]"
                            string="All Members" help="Invoiced/Paid/Free"/>
                    <group expand="0" string="Group By" colspan="10" col="8">
                        <filter string="Membership Status" domain="[]" context="{'group_by': 'membership_status'}"/>
                        <filter string="Start Month" help="Starting Month Of Membership" domain="[]"
                                context="{'group_by':'membership_start'}"/>
                        <filter string="End Month" help="Ending Month Of Membership" domain="[]"
                                context="{'group_by':'membership_stop'}"/>
                        <filter string="Gender" domain="[]" context="{'group_by': 'gender'}"/>
                    </group>
                </search>
            </xpath>
        </field>
    </record>


    <record id="membership.action_membership_members" model="ir.actions.act_window">
        <field name="domain">[('free_member','=',True)]</field>
        <field name="context">{}</field>
    </record>


    <record model="ir.actions.act_window.view" id="membership.action_membership_members_view_form">
        <field name="view_id" ref="member_member_form_view"/>
    </record>
    <record model="ir.actions.act_window.view" id="membership.action_membership_members_view_tree">
        <field name="sequence">1</field>
    </record>

    <record model="ir.actions.act_window.view" id="membership.action_membership_members_view_kanban">
        <field name="sequence">2</field>
    </record>

    <record id="membership.menu_membership" model="ir.ui.menu">
        <field name="parent_id" eval="ref('menu_member_general')"/>
        <field name="groups_id" eval="[(4, ref('member_user.group_user_member'))]"/>
    </record>
</odoo>
