<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="assets_editor" inherit_id="website.assets_editor" name="Event Editor">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/website_event/static/src/js/website.tour.event.js"></script>
        </xpath>
    </template>

    <template id="header_footer_custom" inherit_id="website.footer_default" name="Footer Events Link">
        <xpath expr="//ul[@id='products']" position="inside">
            <li>
                <a href="/event">Events</a>
            </li>
        </xpath>
    </template>

    <template id="registration_template">
        <form id="registration_form" t-attf-action="/event/#{slug(event)}/registration/new" method="post">
            <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
            <table itemprop="offers" class="table table-striped">
                <thead>
                    <tr>
                        <th class="col-sm-4 col-md-6">Ticket Type</th>
                        <th>End of Registration</th>
                        <th class="o_th_price">Price</th>
                        <th>Quantity</th>
                    </tr>
                </thead>
                <tbody>
                    <tr t-if="event.state == 'confirm'">
                        <td>Event Registration</td>
                        <td>
                            <t t-if="event.date_begin">
                                <span t-esc="event.date_begin_located[:-3]"/>
                            </t>
                            <t t-if="not event.date_begin">
                                <span>Unlimited</span>
                            </t>
                        </td>
                        <td>Free</td>
                        <td>
                            <button type="submit"
                                    t-if="event.state == 'confirm' and (event.seats_availability == 'unlimited' or event.seats_available)"
                                    class="btn btn-primary btn-lg pull-right a-submit" t-attf-id="#{event.id}">Register
                                Now
                            </button>
                            <div t-if="not event.state == 'confirm'" class="alert alert-info">
                                <t t-if="event.state == 'draft'">
                                    Event registration not yet started.
                                </t>
                                <t t-if="event.state != 'draft'">
                                    Event registration is closed.
                                </t>
                                <t t-if="uid">
                                    <i class="fa fa-plus-circle">
                                        <a t-attf-href="/web#id=#{event.id}&amp;view_type=form&amp;model=event.event">
                                            <em>Configure and Launch Event Registration</em>
                                        </a>
                                    </i>
                                </t>
                            </div>
                            <select t-if="event.seats_available or event.seats_availability == 'unlimited'"
                                    name="nb_register-0" class="form-control">
                                <t t-foreach="range(0, (event.seats_availability == 'unlimited' or event.seats_available > 9) and 10 or event.seats_available+1)"
                                   t-as="nb">
                                    <option t-esc="nb"/>
                                </t>
                            </select>
                            <span t-if="event.seats_availability == 'limited' and not event.seats_available">Sold Out
                            </span>
                        </td>
                    </tr>
                </tbody>
            </table>

        </form>
    </template>

    <template id="registration_attendee_details" name="Registration Attendee Details">
        <div id="modal_attendees_registration" class="modal fade" tabindex="-1" role="dialog">
            <div class="modal-dialog modal-lg">
                <form id="attendee_registration" t-attf-action="/event/#{slug(event)}/registration/confirm"
                      method="post" class="js_website_submit_form">
                    <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">x</button>
                            <h4 class="modal-title" id="myModalLabel">
                                <strong>Attendees</strong>
                            </h4>
                        </div>
                        <div class="modal-body">
                            <div class="container">
                                <t t-set="counter_type" t-value="1"/>
                                <t t-set="counter" t-value="0"/>
                                <t t-foreach="tickets" t-as="ticket">
                                    <h4 class="page-header mt16">
                                        <strong>
                                            Ticket Type #<t t-raw="counter_type"/>:
                                            <t t-esc="ticket['name']"/>
                                            <t t-if="ticket['price'] == 0">(Free)</t>
                                        </strong>
                                    </h4>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <strong>Name</strong>
                                        </div>
                                        <div class="col-md-5">
                                            <strong>Email</strong>
                                        </div>
                                        <div class="col-md-3">
                                            <strong>Phone</strong>
                                            <span class="text-muted">(Optional)</span>
                                        </div>
                                    </div>
                                    <t t-foreach="range(1, ticket['quantity'] + 1)" t-as="att_counter"
                                       name="attendee_loop">
                                        <t t-set="counter" t-value="counter + 1"/>
                                        <div class="row mb4">
                                            <t t-set="attendee_placeholder">Attendee #%s</t>
                                            <div class="col-md-4">
                                                <input class='form-control' type='text' t-attf-name="#{counter}-name"
                                                       required="This field is required"
                                                       t-att-placeholder="attendee_placeholder %counter"/>
                                            </div>
                                            <div class="col-md-5">
                                                <input class='form-control' type='email' t-attf-name="#{counter}-email"
                                                       required="This field is required"/>
                                            </div>
                                            <div class="col-md-3">
                                                <input class='form-control' type='tel' t-attf-name="#{counter}-phone"/>
                                            </div>
                                            <input class='hidden' type='text' t-attf-name="#{counter}-ticket_id"
                                                   t-attf-value="#{ticket['id']}"/>
                                        </div>
                                    </t>
                                    <t t-set="counter_type" t-value="counter_type + 1"/>
                                </t>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <div class="pull-left">
                                <button type="submit" class="btn btn-primary">Continue</button>
                                or
                                <a class="js_goto_event" style="cursor: pointer;">Cancel Registration</a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </template>

    <template id="registration_complete" name="Registration Completed">
        <t t-call="website.layout">
            <div class="container">
                <h3>We are glad to confirm your registration to our event</h3>
                <div class="row">
                    <div class="col-md-3 mt16">
                        <h4>Event Details</h4>
                    </div>
                    <div class="col-md-9 mt16">
                        <h4>
                            <a t-attf-href="/event/#{slug(event)}">
                                <t t-esc="event.name"/>
                            </a>
                        </h4>
                        <i class="fa fa-clock-o"/>
                        <span itemprop="startDate" t-esc="event.date_begin_located[:-3]"></span>
                        <i>to</i>
                        <span itemprop="endDate" t-esc="event.date_end_located[:-3]"></span>
                        <div itemprop="location" class="mt16 mb8" t-field="event.address_id" t-options='{
                            "widget": "contact",
                            "fields": ["name", "address", "phone", "mobile", "fax", "email"]
                            }'/>
                    </div>
                    <div class="col-md-3 mt16">
                        <h4>Your registration</h4>
                    </div>
                    <div class="col-md-9 mt16">
                        <table class='table table-bordered table-striped'>
                            <thead>
                                <tr>
                                    <th>Reference</th>
                                    <th>Name</th>
                                    <th>E-mail</th>
                                    <th>Phone</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="attendees" t-as="attendee">
                                    <tr>
                                        <td>
                                            <t t-esc="attendee.id"/>
                                        </td>
                                        <td>
                                            <i class="fa fa-user"></i>
                                            <t t-if='attendee.name'>
                                                <t t-esc="attendee.name"/>
                                            </t>
                                            <t t-if='not attendee.name'>N/A</t>
                                        </td>
                                        <td>
                                            <i class="fa fa-envelope"></i>
                                            <t t-if='attendee.email'>
                                                <t t-esc="attendee.email"/>
                                            </t>
                                            <t t-if='not attendee.email'>N/A</t>
                                        </td>
                                        <td>
                                            <i class="fa fa-phone"></i>
                                            <t t-if='attendee.phone'>
                                                <t t-esc="attendee.phone"/>
                                            </t>
                                            <t t-if='not attendee.phone'>N/A</t>
                                        </td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </t>
    </template>

</odoo>
