<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>
        <record id="purchase_order_form_inherit" model="ir.ui.view">
            <field name="name">purchase.order.form.inherit</field>
            <field name="model">purchase.order</field>
            <field name="inherit_id" ref="purchase.purchase_order_form"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='button_done']" position="after">
                    <button name="button_advance_payment" type="object" string="Advance Payment"
                            style="background-color:#D4BC43;color:#EADDCA;"
                            groups="purchase.group_purchase_user,gbs_samuda_service_order.group_service_order_user_unit,gbs_samuda_service_order.group_service_order_user_ho"
                            attrs="{'invisible':['|',('region_type','=', 'foreign'),('state','not in', 'done')]}"/>
                </xpath>
                <notebook position="inside">
                    <page string="Vendor Advances">
                        <field name="vendor_advance_line" widget="one2many_list" readonly="1">
                            <tree string="Vendor Advances">
                                <field name="name" string="REF #"/>
                                <field name="partner_id" string="Vendor"/>
                                <field name="purchase_order_id" string="Order"/>
                                <field name="date"/>
                                <field name="advance_amount" sum="advance_amount"/>
                                <field name="adjusted_amount" sum="adjusted_amount"/>
                                <field name="outstanding_amount" sum="adjusted_amount"/>
                                <field name="state"/>
                            </tree>

                            <form string="Vendor Advance" duplicate="0">
                                <header>
                                    <field name="state" widget="statusbar"
                                           statusbar_visible="draft,confirm,approve,done"/>
                                </header>
                                <sheet>
                                    <div class="pull-left">
                                        <h1>
                                            <field name="name" readonly="1" nolabel="1"/>
                                        </h1>
                                    </div>
                                    <group name="main">
                                        <group>
                                            <field name="partner_id" string="Vendor" required="True"
                                                   options='{"no_open": True,"no_create": 1, "no_create_edit":1}'/>
                                            <field name="purchase_order_id" string="Order Reference" required="True"
                                                   options='{"no_open": True,"no_create": 1, "no_create_edit":1}'/>
                                            <field name="journal_id" string="Bank Name" required="1"
                                                   domain="[('type', '=', 'bank')]"
                                                   options='{"no_open": True,"no_create": 1, "no_create_edit":1}'/>


                                        </group>
                                        <group>
                                            <field name="date"/>
                                            <field name="operating_unit_id" required="True"
                                                   options='{"no_open": True,"no_create": 1, "no_create_edit":1}'/>
                                            <field name="move_id" attrs="{'invisible': [('move_id', '=',False )]}"/>
                                            <field name="description" required="1"/>
                                        </group>
                                    </group>
                                    <group string="Advance Calculation">
                                        <group>
                                            <field name="advance_amount" widget="monetary"
                                                   options="{'currency_field': 'currency_id'}"/>
                                            <field name="security_deposit" invisible="1"
                                                   widget="monetary" options="{'currency_field': 'currency_id'}"/>
                                            <field name="vat_account_id"
                                                   options='{"no_open": True,"no_create": 1, "no_create_edit":1}'/>
                                            <field name="tds_account_id"
                                                   options='{"no_open": True,"no_create": 1, "no_create_edit":1}'/>
                                            <field name="company_id" invisible="1"/>
                                        </group>
                                        <group>
                                            <field name="adjusted_amount" readonly="1" widget="monetary"
                                                   options="{'currency_field': 'currency_id'}"/>
                                            <field name="outstanding_amount" widget="monetary"
                                                   options="{'currency_field': 'currency_id'}" readonly="1"/>
                                            <field name="vat_amount" widget="monetary"
                                                   options="{'currency_field': 'currency_id'}"/>
                                            <field name="tds_amount" widget="monetary"
                                                   options="{'currency_field': 'currency_id'}"/>
                                            <field name="payable_to_supplier" widget="monetary" readonly="1"
                                                   options="{'currency_field': 'currency_id'}"/>
                                            <field name="currency_id" invisible="1"/>
                                        </group>
                                    </group>
                                </sheet>

                            </form>
                        </field>
                    </page>
                </notebook>

            </field>
        </record>

    </data>
</odoo>