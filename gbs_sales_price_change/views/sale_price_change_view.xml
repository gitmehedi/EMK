<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- Tree View -->
		<record id="sale_price_change_tree" model="ir.ui.view">
			<field name="name">sale_price_change_tree_view</field>
			<field name="model">sale.price.change</field>
			<field name="arch" type="xml">
				<tree string="Change Products Sale Price">
                    <field name="product_id"/>
                    <field name="list_price"/>
                    <field name="new_price"/>
					<field name="state"/>
				</tree>
			</field>
		</record>

		<!-- Form View -->
		<record id="sale_price_change_form_view" model="ir.ui.view">
			<field name="name">sale_price_change_form_view</field>
			<field name="model">sale.price.change</field>
			<field name="type">form</field>
			<field name="arch" type="xml">
				<form string="Change Products Sale Price">
					<header>
						<button string="Confirm" name="action_confirm" groups="gbs_application_group.group_head_account,gbs_application_group.group_head_sale,gbs_application_group.group_cxo" states="draft" type="object" class="oe_highlight"/>
                    	<button string="Approve" name="action_approve" groups="gbs_application_group.group_cxo" states="validate1" type="object" class="oe_highlight"/>
                    	<button string="Validate" name="action_validate" groups="gbs_application_group.group_cxo,gbs_application_group.group_head_account" states="confirm" type="object" class="oe_highlight"/>
                    	<button string="Refuse" name="action_refuse" groups="gbs_application_group.group_head_account,gbs_application_group.group_cxo" states="confirm,validate1" type="object"/>
                    	<field name="state" widget="statusbar" statusbar_visible="draft,confirm,validate1,validate"/>
               	 	</header>

					<sheet>
						<group>
							<group>
                                <field name="product_id" options="{'no_create_edit': True}" attrs="{'readonly': [('state','in',('validate','validate1'))]}"/>
                                <field name="list_price"/>
                                <field name="new_price" attrs="{'readonly': [('state','in',('validate','validate1'))]}"/>
								<field name="currency_id"/>
							</group>
							<group>
                                <field name="request_date"/>
                                <field name="requested_by"/>
                                <field name="approver1_id" attrs="{'invisible':['|', ('state','=','draft'),('state','=','confirm')]}"/>
                                <field name="approver1_date" attrs="{'invisible':['|', ('state','=','draft'),('state','=','confirm')]}"/>
									<field name="approver2_id" attrs="{'invisible': [('state','in',('draft','confirm','validate1'))]}"/>
                                <field name="approver2_date" attrs="{'invisible': [('state','in',('draft','confirm','validate1'))]}"/>
							</group>
						</group>
	                </sheet>

					<div class="oe_chatter">
						<field name="message_follower_ids" widget="mail_followers"/>
	                    <field name="message_ids" widget="mail_thread"/>
	                </div>

				</form>
			</field>
		</record>

		<!--Default group by on product_id-->
		<record id="view_product_price_change_search" model="ir.ui.view">
            <field name="name">view_product_price_change_search_view</field>
            <field name="model">sale.price.change</field>
            <field name="arch" type="xml">
                <search string="Search Products">
                    <group expand="0" string="Group By">
                        <filter string="Product" name = "group_product_id" context="{'group_by':'product_id'}"/>
                    </group>
                </search>
            </field>
        </record>

		<record id="action_product_sale_price_change" model="ir.actions.act_window">
			<field name="name">Change Product Price</field>
			<field name="res_model">sale.price.change</field>
			<field name="context">{'search_default_group_product_id': 1}</field>
			<field name="view_mode">tree,form</field>
		</record>

        <menuitem name="Sales" id="sales_team.menu_base_partner" groups="gbs_application_group.group_head_sale,gbs_application_group.group_head_account,gbs_application_group.group_cxo" web_icon="sale,static/description/icon.png"/>

        <menuitem id="custom_menu_products" sequence="5" name="Products" groups="gbs_application_group.group_head_sale,gbs_application_group.group_head_account,gbs_application_group.group_cxo" parent="sales_team.menu_base_partner"/>

        <menuitem id="product_sale_price_change_menu_action" name="Change Product Price"
				  groups="gbs_application_group.group_head_sale,gbs_application_group.group_head_account,gbs_application_group.group_cxo"
				  parent="custom_menu_products" sequence="9" action="action_product_sale_price_change"/>

        <menuitem id="sale.menu_product_template_action" parent="custom_menu_products" sequence="8" action="product.product_template_action" groups="gbs_application_group.group_head_sale,gbs_application_group.group_head_account,gbs_application_group.group_cxo"/>

        <menuitem id="product_sale_price_change_history_menu_action" name="Product Price History"
				  groups="gbs_application_group.group_head_sale,gbs_application_group.group_head_account,gbs_application_group.group_cxo"
                  parent="custom_menu_products" sequence="10" action="action_product_sale_price_change_history"/>

    </data>
</odoo>