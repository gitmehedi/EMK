<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <record id="customized_sale_order_form_view" model="ir.ui.view">
            <field name="name">customized_sale_order_form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <data>
                    <header>
                        <button name="action_to_submit"
                                groups="sales_team.group_sale_salesman_all_leads,gbs_application_group.group_head_sale,gbs_application_group.group_head_account,gbs_application_group.group_cxo"
                                states="to_submit"
                                type="object"
                                class="btn-primary"
                                string="Submit"/>

                        <button name="action_submit"
                                groups="gbs_application_group.group_head_sale,gbs_application_group.group_cxo"
                                states="draft"
                                type="object"
                                class="btn-primary"
                                string="Confirm"/>

                        <button name="action_validate"
                                groups="gbs_application_group.group_head_account,gbs_application_group.group_cxo"
                                attrs="{'invisible': [('double_validation','=',False)]}"
                                states="validate"
                                type="object"
                                class="btn-primary "
                                string="Validate"/>

                        <button name="action_create_delivery_order"
                                type="object"
                                states="done"
                                groups="account.group_account_user,gbs_application_group.group_head_account,gbs_application_group.group_cxo"
                                class="btn-primary"
                                string="Delivery Authorization"/>

                    </header>

                    <!-- Conform Sale 1 -->
                    <xpath expr="//button[@name='action_confirm' and @states='draft']" position="replace">
                        <button name="action_confirm"
                                attrs="{'invisible':['|', ('double_validation','=',True),('state','in',('draft','validate','done','cancel','sale'))]}"
                                string="Confirm Sale1"
                                groups="gbs_application_group.group_head_sale,gbs_application_group.group_head_account"
                                type="object"
                                class="btn-primary o_sale_confirm" invisible="1"/>
                    </xpath>

                    <!--Approve Sale-->
                    <xpath expr="//button[@name='action_confirm' and @states='sent']" position="replace">
                        <button name="action_confirm" states="sent"
                                groups="gbs_application_group.group_cxo"
                                string="Approve"
                                class="btn-primary o_sale_confirm"
                                type="object"/>
                    </xpath>

                    <!--Send by email-->
                    <xpath expr="//button[@name='action_quotation_send' and @states='draft']" position="replace">
                        <button name="action_quotation_send"
                                groups="gbs_application_group.group_head_sale,gbs_application_group.group_cxo"
                                string="Send by Email" type="object" states="done"/>
                    </xpath>

                    <!--Print-->
                    <xpath expr="//button[@name='print_quotation' and @states='draft']" position="replace">
                        <button name="print_quotation"
                                groups="gbs_application_group.group_head_sale,gbs_application_group.group_cxo"
                                string="Print" type="object" states="done"/>
                    </xpath>

                    <!-- Cancel-->
                    <xpath expr="//button[@name='action_cancel']" position="replace">
                        <button name="action_cancel" states="validate,sent,sale,sent" type="object" string="Cancel"/>
                    </xpath>

                    <!--Set to quotation-->
                    <xpath expr="//button[@name='action_draft']" position="replace">
                        <button name="action_draft" states="cancel" type="object" string="Set to Quotation"/>
                    </xpath>

                    <!--Lock-->
                    <xpath expr="//button[@name='action_done']" position="replace">
                        <button name="action_done" type="object" string="Lock" states="sale"  class="btn-primary"
                             groups="gbs_application_group.group_head_sale,gbs_application_group.group_cxo"
                             help="If the sale is locked, you can not modify it anymore. However, you will still be able to invoice or deliver."/>
                    </xpath>

                    <xpath expr="//field[@name='state']" position="replace">
                        <field name="state" widget="statusbar" statusbar_visible="draft,sent,sale"/>
                    </xpath>

                    <xpath expr="//field[@name='company_id']" position="after">
                        <field name="credit_sales_or_lc"
                               attrs="{'readonly':[('state','in',('draft','sent','validate','done','cancel','sale'))]}"/>
                    </xpath>

                    <xpath expr="//group/group/field[@name='payment_term_id']" position="before">
                        <field name="double_validation" invisible="1"/>
                    </xpath>

                    <xpath expr="//group/group/field[@name='payment_term_id']" position="before">
                        <field name="pack_type" options="{'no_open': True, 'no_create': False}" attrs="{'readonly':[('state','in',('draft','sent','validate','done','cancel','sale'))]}"/>
                    </xpath>

                    <xpath expr="//field[@name='payment_term_id']" position="replace">
                        <field name="payment_term_id"
                               attrs="{'readonly':[('state','in',('draft','sent','validate','done','cancel','sale'))]}"
                               options="{'no_create': True}"/>
                    </xpath>

                    <xpath expr="//field[@name='partner_id']" position="replace">
                        <field name="partner_id"
                               attrs="{'readonly':[('state','in',('draft','sent','validate','done','cancel','sale'))]}"
                               domain="[('customer','=',True)]"
                               context="{'search_default_customer':1, 'show_address': 1}"
                               options='{"always_reload": True}'/>
                    </xpath>
                    <xpath expr="//field[@name='date_order']" position="replace">
                        <field name="date_order"
                               attrs="{'invisible': [('state', 'in', ['sale', 'done', 'cancel'])],'readonly':[('state','in',('draft','sent','validate','done','cancel','sale'))]}"/>
                    </xpath>

                    <xpath expr="//field[@name='validity_date']" position="replace">
                        <field name="validity_date"
                               attrs="{'invisible': [('state', 'in', ['sale', 'done'])],'readonly':[('state','in',('draft','sent','validate','done','cancel','sale'))]}"/>
                    </xpath>

                    <xpath expr="//field[@name='pricelist_id']" position="replace">
                        <field name="pricelist_id" groups="product.group_sale_pricelist"
                               attrs="{'readonly':[('state','in',('draft','sent','validate','done','cancel','sale'))]}"/>
                    </xpath>

                    <xpath expr="//field[@name='price_subtotal']" position="replace">
                        <field name="price_subtotal"
                               attrs="{'readonly':[('state','in',('draft','sent','validate','done','cancel','sale'))]}"
                               widget="monetary" groups="sale.group_show_price_subtotal"/>
                    </xpath>

                    <xpath expr="//field[@name='credit_sales_or_lc']" position="after">
                        <field name="currency_id" options="{'no_open': True, 'no_create': True}"
                               attrs="{'readonly':[('state','in',('draft','sent','validate','done','cancel','sale'))]}"/>
                    </xpath>

                    <xpath expr="//field[@name='state']" position="replace">
                        <field name="state" widget="statusbar" statusbar_visible="to_submit,draft,sent,sale,done"/>
                    </xpath>

                    <xpath expr="//field[@name='payment_term_id']" position="replace">
                        <field name="payment_term_id"
                               attrs="{'readonly':[('state','in',('draft','sent','validate','done','cancel','sale'))]}"
                               options="{'no_open': True, 'no_create': True}"/>
                    </xpath>

                    <xpath expr="//field[@name='confirmation_date']" position="replace">
                        <field name="confirmation_date" invisible="1"/>
                    </xpath>

                    <xpath expr="//field[@name='partner_invoice_id']" position="replace">
                        <field name="partner_invoice_id"
                               attrs="{'readonly':[('state','in',('draft','sent','validate','done','cancel','sale'))]}"/>
                    </xpath>

                    <xpath expr="//field[@name='partner_shipping_id']" position="replace">
                        <field name="partner_shipping_id"
                               attrs="{'readonly':[('state','in',('draft','sent','validate','done','cancel','sale'))]}"/>
                    </xpath>

                    <xpath expr="//field[@name='payment_term_id']" position="replace">
                        <field name="payment_term_id" invisible="1"/>
                    </xpath>

                    <xpath expr="//field[@name='pack_type']" position="after">
                        <field name="pi_no" attrs="{'invisible':[('credit_sales_or_lc', '!=', 'lc_sales')]}" options="{'no_quick_create':True,'no_create_edit':True,'no_open':True}"/>
                    </xpath>

                    <xpath expr="//field[@name='pi_no']" position="after">
                        <field name="lc_no" attrs="{'invisible':[('credit_sales_or_lc', '!=', 'lc_sales')]}" options="{'no_quick_create':True,'no_create_edit':True,'no_open':True}"/>
                    </xpath>

                </data>
            </field>
        </record>


        <record id="gbs_sale_order_action_pendding_orders" model="ir.actions.act_window">
            <field name="name">Sales Orders</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,kanban,form,calendar,pivot,graph</field>
            <field name="domain">[('state','=','done')]</field>
            <field name="help" type="html">
                <p class="oe_view_nocontent_create">
                    Create a Quotation, the first step of a new sale.
                </p>
                <p>
                    Once the quotation is confirmed, it becomes a sales order.
                    You'll be able to invoice it and collect payments.
                    From the <i>Sales Orders</i> menu, you can track delivery
                    orders or services.
                </p>

            </field>
        </record>

        <menuitem id="delivery_order_pendding" name="Pending DA" parent="delivery_order.delivery_order_menu"
                  groups="account.group_account_user,gbs_application_group.group_head_account,gbs_application_group.group_cxo"
                  action="gbs_sale_order_action_pendding_orders" sequence="14"/>

        <record id="sale.menu_sale_order" model="ir.ui.menu">
            <field name="groups_id"
                   eval="[(4,ref('gbs_application_group.group_cxo')),(4,ref('gbs_application_group.group_head_account'))]"/>
        </record>

        <menuitem id="sale.menu_products"
                  name="Product Variants"
                  parent="product_sales_pricelist.custom_menu_products"
                  groups="sales_team.group_sale_salesman_all_leads"
                  action="product.product_normal_action_sell"
                  sequence="10" />
    </data>
</odoo>